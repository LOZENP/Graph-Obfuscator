<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lua Bytecode Obfuscator v2.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fengari-web/0.1.4/fengari-web.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .settings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .setting-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .setting-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .setting-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .setting-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .editor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .editor-section {
            display: flex;
            flex-direction: column;
        }

        .editor-section h3 {
            margin-bottom: 10px;
            color: #333;
            font-size: 1.2em;
        }

        textarea {
            flex: 1;
            min-height: 400px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-obfuscate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-obfuscate:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-copy {
            background: #28a745;
            color: white;
        }

        .btn-copy:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-clear {
            background: #dc3545;
            color: white;
        }

        .btn-clear:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-download {
            background: #17a2b8;
            color: white;
        }

        .btn-download:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .info-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }

        .info-panel span {
            margin: 0 15px;
            font-weight: 600;
            color: #666;
        }

        @media (max-width: 768px) {
            .editor-container {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-weight: 600;
        }

        .loading.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîí Lua Bytecode Obfuscator</h1>
            <p>Professional Lua Code Protection | Version 2.0</p>
        </div>

        <div class="main-content">
            <div class="settings">
                <div class="setting-group">
                    <label for="junkAmount">Junk Opcodes Amount</label>
                    <input type="number" id="junkAmount" value="3000" min="100" max="10000">
                </div>
                <div class="setting-group">
                    <label for="fakeConst">Fake Constants Amount</label>
                    <input type="number" id="fakeConst" value="500" min="50" max="2000">
                </div>
            </div>

            <div class="editor-container">
                <div class="editor-section">
                    <h3>üìù Input Lua Code</h3>
                    <textarea id="inputCode" placeholder="-- Enter your Lua code here
local message = &quot;Hello World&quot;
local number = 42
print(message)
print(number)"></textarea>
                </div>
                <div class="editor-section">
                    <h3>üîê Obfuscated Output</h3>
                    <textarea id="outputCode" readonly placeholder="Obfuscated code will appear here..."></textarea>
                </div>
            </div>

            <div class="loading" id="loading">‚è≥ Obfuscating your code...</div>

            <div class="buttons">
                <button class="btn-obfuscate" onclick="obfuscateCode()">üîí Obfuscate</button>
                <button class="btn-copy" onclick="copyOutput()">üìã Copy Output</button>
                <button class="btn-download" onclick="downloadOutput()">üíæ Download</button>
                <button class="btn-clear" onclick="clearAll()">üóëÔ∏è Clear All</button>
            </div>

            <div class="info-panel">
                <span>Input Size: <strong id="inputSize">0</strong> bytes</span>
                <span>Output Size: <strong id="outputSize">0</strong> bytes</span>
                <span>Expansion: <strong id="expansion">0x</strong></span>
            </div>
        </div>
    </div>

    <script type="application/lua">
-- Your Lua obfuscator code embedded here
local function randomString(len)
    local chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"
    local result=""
    for i=1,len do
        result=result..chars:sub(math.random(1,#chars),math.random(1,#chars))
    end
    return result
end

local function randomVarName()
    local prefixes={"_","l_","ll_","I_","O_","o_","i_e","L_"}
    return prefixes[math.random(#prefixes)]..randomString(math.random(3,8))
end

local function encodeNumber(num)
    local hex=string.format("%X",num)
    local padding=randomString(math.random(2,6))
    return padding..hex..randomString(math.random(2,6))
end

local function encodeString(str)
    local result=""
    for i=1,#str do
        result=result..string.format("%02X",string.byte(str,i))
    end
    return randomString(4)..result..randomString(4)
end

local function generateFakeChains(count)
    local chains={}
    local vars={}
    for i=1,math.min(count,150) do
        vars[i]=randomVarName()
    end
    for i=1,#vars do
        if i==#vars then
            table.insert(chains,"local "..vars[i].."=0x"..string.format("%x",math.random(1000,9999)))
        else
            table.insert(chains,"local "..vars[i].."="..vars[i+1])
        end
    end
    return table.concat(chains," ")
end

local function generateJunkOpcodes(count)
    local junkOps={"MV","GG","SG","GT","ST","NT","SF","AD","SB","ML","DV","MD","PW","UM","NO","CO","JP","EQ","LT","LE","TS","TX","TC","VA","GU","SU","CS","FL","FP","TL","SL","LB","NL","XX","YY","ZZ","AA","BB","CC","DD","EE","FF","GH","IJ"}
    local junk={}
    for i=1,count do
        local op=junkOps[math.random(#junkOps)]
        local encoded=op..encodeNumber(math.random(0,255))..encodeNumber(math.random(0,255))..randomString(math.random(15,35))
        table.insert(junk,encoded)
    end
    return junk
end

local function generateFakeConstants(count)
    local fakes={}
    for i=1,count do
        local t=math.random(1,3)
        if t==1 then
            fakes[i+10000]=math.random(0,100000)
        elseif t==2 then
            fakes[i+10000]=randomString(math.random(5,20))
        else
            fakes[i+10000]="__E_"..math.random(1000,9999).."__"
        end
    end
    return fakes
end

local OPCODES={LOADK="LD",LOADN="LN",PRINT="PR"}

local function parseSimpleLua(code)
    local instructions={}
    local constants={}
    
    local function addConstant(value)
        for i,v in ipairs(constants) do
            if v==value then return i end
        end
        table.insert(constants,value)
        return #constants
    end
    
    code=code:gsub("%-%-[^\n]*","")
    code=code:gsub("%s+"," ")
    
    for var,num in code:gmatch("local%s+([%w_]+)%s*=%s*(%d+)") do
        table.insert(instructions,{op=OPCODES.LOADN,arg1=var,arg2=tonumber(num)})
    end
    
    for var,str in code:gmatch('local%s+([%w_]+)%s*=%s*"([^"]*)"') do
        table.insert(instructions,{op=OPCODES.LOADK,arg1=var,arg2=addConstant(str)})
    end
    
    for var,str in code:gmatch("local%s+([%w_]+)%s*=%s*'([^']*)'") do
        table.insert(instructions,{op=OPCODES.LOADK,arg1=var,arg2=addConstant(str)})
    end
    
    for str in code:gmatch('print%s*%(%s*"([^"]*)"') do
        table.insert(instructions,{op=OPCODES.PRINT,arg1=addConstant(str)})
    end
    
    for str in code:gmatch("print%s*%(%s*'([^']*)'") do
        table.insert(instructions,{op=OPCODES.PRINT,arg1=addConstant(str)})
    end
    
    for var in code:gmatch("print%s*%(%s*([%w_]+)%s*%)") do
        if not var:match("^%d") then
            table.insert(instructions,{op=OPCODES.PRINT,arg1=var,arg2="var"})
        end
    end
    
    return {instructions=instructions,constants=constants}
end

local function encodeBytecode(instructions,constants,junkAmount)
    local bytecode={}
    local junkOpcodes=generateJunkOpcodes(junkAmount)
    
    local initialJunk=math.floor(junkAmount*0.3)
    for i=1,initialJunk do
        table.insert(bytecode,junkOpcodes[math.random(#junkOpcodes)])
    end
    
    for _,instr in ipairs(instructions) do
        local encoded=instr.op
        
        if instr.arg1 then
            if type(instr.arg1)=="number" then
                encoded=encoded..encodeNumber(instr.arg1)
            else
                encoded=encoded..encodeString(instr.arg1)
            end
        end
        
        if instr.arg2 then
            if type(instr.arg2)=="number" then
                encoded=encoded..encodeNumber(instr.arg2)
            elseif instr.arg2~="var" then
                encoded=encoded..encodeString(instr.arg2)
            else
                encoded=encoded..randomString(4)
            end
        end
        
        encoded=encoded..randomString(math.random(10,30))
        table.insert(bytecode,encoded)
        
        local junkAfter=math.random(50,150)
        for j=1,junkAfter do
            table.insert(bytecode,junkOpcodes[math.random(#junkOpcodes)])
        end
    end
    
    local trailingJunk=math.floor(junkAmount*0.3)
    for i=1,trailingJunk do
        table.insert(bytecode,junkOpcodes[math.random(#junkOpcodes)])
    end
    
    return bytecode
end

local function generateVM(bytecode,constants,fakeConstCount)
    local vmVars={
        bytecode=randomVarName(),
        constants=randomVarName(),
        stack=randomVarName(),
        pc=randomVarName(),
        vars=randomVarName(),
        instr=randomVarName(),
        op=randomVarName(),
        decode=randomVarName(),
        decodeStr=randomVarName(),
        decodeNum=randomVarName(),
        exec=randomVarName(),
        result=randomVarName()
    }
    
    local constStr="{"
    local fakeConsts=generateFakeConstants(fakeConstCount)
    
    for idx,val in pairs(fakeConsts) do
        if type(val)=="string" then
            constStr=constStr.."["..idx..']="'..val..'",'
        else
            constStr=constStr.."["..idx.."]="..val..","
        end
    end
    
    for i,const in ipairs(constants) do
        if type(const)=="string" then
            local charCodes={}
            for j=1,#const do
                table.insert(charCodes,string.byte(const,j))
            end
            constStr=constStr.."["..i.."]=string.char("..table.concat(charCodes,",").."),"
        else
            constStr=constStr.."["..i.."]="..const..","
        end
    end
    constStr=constStr.."}"
    
    local bcStr="{"
    for _,bc in ipairs(bytecode) do
        bcStr=bcStr..'"'..bc..'",'
    end
    bcStr=bcStr.."}"
    
    local fakeChains=generateFakeChains(math.random(80,120))
    
    local vm="(function() "..fakeChains.." local "..vmVars.bytecode.."="..bcStr.." local "..vmVars.constants.."="..constStr.." local "..vmVars.stack.."={} local "..vmVars.vars.."={} local function "..vmVars.decodeStr.."(s) local r=\"\" for i=1,#s,2 do local b=tonumber(s:sub(i,i+1),16) if b then r=r..string.char(b) end end return r end local function "..vmVars.decodeNum.."(s) local n=s:match(\"([0-9A-F]+)\") return n and tonumber(n,16) or 0 end local function "..vmVars.exec.."() local "..vmVars.pc.."=1 while "..vmVars.pc.."<=#"..vmVars.bytecode.." do local "..vmVars.instr.."="..vmVars.bytecode.."["..vmVars.pc.."] local "..vmVars.op.."="..vmVars.instr..":sub(1,2) if "..vmVars.op.."==\""..OPCODES.LOADK.."\" then local idx="..vmVars.decodeNum.."("..vmVars.instr..":sub(3)) local var="..vmVars.decodeStr.."("..vmVars.instr..":sub(20)) "..vmVars.vars.."[var]="..vmVars.constants.."[idx] elseif "..vmVars.op.."==\""..OPCODES.LOADN.."\" then local var="..vmVars.decodeStr.."("..vmVars.instr..":sub(3)) local num="..vmVars.decodeNum.."("..vmVars.instr..":sub(15)) "..vmVars.vars.."[var]=num elseif "..vmVars.op.."==\""..OPCODES.PRINT.."\" then local idx="..vmVars.decodeNum.."("..vmVars.instr..":sub(3)) if "..vmVars.constants.."[idx] then print("..vmVars.constants.."[idx]) else local var="..vmVars.decodeStr.."("..vmVars.instr..":sub(20)) if "..vmVars.vars.."[var] then print("..vmVars.vars.."[var]) end end end "..vmVars.pc.."="..vmVars.pc.."+1 end end local "..vmVars.result.."="..vmVars.exec.."() return "..vmVars.result.." end)()"
    
    return vm
end

function obfuscate(inputCode, junkAmount, fakeConstAmount)
    math.randomseed(os.time())
    local parsed=parseSimpleLua(inputCode)
    local bytecode=encodeBytecode(parsed.instructions,parsed.constants,junkAmount)
    local vm=generateVM(bytecode,parsed.constants,fakeConstAmount)
    return vm
end
    </script>

    <script>
        function obfuscateCode() {
            const input = document.getElementById('inputCode').value;
            const junkAmount = parseInt(document.getElementById('junkAmount').value) || 3000;
            const fakeConst = parseInt(document.getElementById('fakeConst').value) || 500;
            
            if (!input.trim()) {
                alert('Please enter some Lua code to obfuscate!');
                return;
            }

            document.getElementById('loading').classList.add('active');
            
            setTimeout(() => {
                try {
                    const result = fengari.load(`return obfuscate([=====[${input}]=====], ${junkAmount}, ${fakeConst})`)();
                    document.getElementById('outputCode').value = result;
                    updateStats();
                } catch (error) {
                    alert('Error obfuscating code: ' + error.message);
                    console.error(error);
                }
                document.getElementById('loading').classList.remove('active');
            }, 100);
        }

        function copyOutput() {
            const output = document.getElementById('outputCode');
            if (!output.value) {
                alert('No output to copy!');
                return;
            }
            output.select();
            document.execCommand('copy');
            alert('‚úÖ Obfuscated code copied to clipboard!');
        }

        function downloadOutput() {
            const output = document.getElementById('outputCode').value;
            if (!output) {
                alert('No output to download!');
                return;
            }
            
            const blob = new Blob([output], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'obfuscated.lua';
            a.click();
            URL.revokeObjectURL(url);
        }

        function clearAll() {
            if (confirm('Clear all input and output?')) {
                document.getElementById('inputCode').value = '';
                document.getElementById('outputCode').value = '';
                updateStats();
            }
        }

        function updateStats() {
            const inputSize = document.getElementById('inputCode').value.length;
            const outputSize = document.getElementById('outputCode').value.length;
            const expansion = outputSize > 0 ? (outputSize / Math.max(inputSize, 1)).toFixed(2) : 0;
            
            document.getElementById('inputSize').textContent = inputSize;
            document.getElementById('outputSize').textContent = outputSize;
            document.getElementById('expansion').textContent = expansion + 'x';
        }

        document.getElementById('inputCode').addEventListener('input', updateStats);
        document.getElementById('outputCode').addEventListener('input', updateStats);
    </script>
</body>
</html>
